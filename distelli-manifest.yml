iamchristopher/AscensionServer:

  Build:
    - npm install
    - npm test

  PkgInclude:
    - '*'

  PreInstall:
    - echo "Begin PreInstall"
    - sudo apt-get -y update
    - echo "Installing NVM"
    - wget -qO- https://raw.githubusercontent.com/creationix/nvm/v0.29.0/install.sh | bash
    - set +e; source ~/.nvm/nvm.sh; set -e
    - echo "Installing NVM version"
    - nvm install v4.2.1
    - nvm use v4.2.1
    - nvm alias default v4.2.1
    - echo "Creating symlink for Node"
    - 'if [ -h /usr/bin/node ]; then'
    -     echo "Symbolic link already exists"
    - else
    -     echo "Symbolic link created"
    -     sudo ln -s /usr/bin/nodejs /usr/bin/node
    - fi

  PostInstall:
    - echo "Begin PostInstall"
    - set +e; source ~/.nvm/nvm.sh; set -e
    - echo "Installing PM2"
    - sudo npm i pm2 -g
    - echo "Done Installing PM2"

  Start:
    - echo "Starting application"
    - /usr/local/bin/pm2 kill
    - /usr/local/bin/pm2 startOrGracefulReload process-production.json

  PostStart:
    - /usr/local/bin/pm2 list

  Terminate:
    - echo "Terminating application"
    - /usr/local/bin/pm2 stop process-production.json
